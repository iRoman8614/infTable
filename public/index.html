<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Virtualized Table - Working Version</title>
</head>
<body>
<h1>–í–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h1>

<!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã -->
<script>
  console.log('[HTML] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤...');

  // === –ü–†–û–í–ê–ô–î–ï–† –ó–ê–ì–û–õ–û–í–ö–û–í ===
  window.HeadersProvider = function() {
    console.log('[HeadersProvider] –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞');

    return {
      headers: [
        {
          id: "factory1",
          parentId: null,
          name: "–ó–∞–≤–æ–¥ ‚Ññ1 '–ú–µ—Ç–∞–ª–ª—É—Ä–≥'",
          metadata: {
            color: "#343434",
            workCount: 150
          }
        },
        {
          id: "workshop1",
          parentId: "factory1",
          name: "–¶–µ—Ö —Å–±–æ—Ä–∫–∏ ‚Ññ1",
          metadata: {
            color: "#4caf50",
            workCount: 45
          }
        },
        {
          id: "line1",
          parentId: "workshop1",
          name: "–õ–∏–Ω–∏—è –ê",
          metadata: {
            color: "#ff9800",
            workCount: 15
          }
        },
        {
          id: "station1",
          parentId: "line1",
          name: "–°—Ç–∞–Ω—Ü–∏—è 1",
          metadata: {
            color: "#f44336",
            workCount: 3
          }
        },
        {
          id: "station2",
          parentId: "line1",
          name: "–°—Ç–∞–Ω—Ü–∏—è 2",
          metadata: {
            color: "#f44336",
            workCount: 4
          }
        },
        {
          id: "station3",
          parentId: "line1",
          name: "–°—Ç–∞–Ω—Ü–∏—è 3",
          metadata: {
            color: "#f44336",
            workCount: 5
          }
        },
        {
          id: "line2",
          parentId: "workshop1",
          name: "–õ–∏–Ω–∏—è –ë",
          metadata: {
            color: "#ff9800",
            workCount: 12
          }
        },
        {
          id: "station4",
          parentId: "line2",
          name: "–°—Ç–∞–Ω—Ü–∏—è 4",
          metadata: {
            color: "#f44336",
            workCount: 2
          }
        },
        {
          id: "station5",
          parentId: "line2",
          name: "–°—Ç–∞–Ω—Ü–∏—è 5",
          metadata: {
            color: "#f44336",
            workCount: 3
          }
        },
        {
          id: "workshop2",
          parentId: "factory1",
          name: "–¶–µ—Ö –º–µ—Ö–∞–Ω–æ–æ–±—Ä–∞–±–æ—Ç–∫–∏",
          metadata: {
            color: "#4caf50",
            workCount: 65
          }
        },
        {
          id: "section1",
          parentId: "workshop2",
          name: "–£—á–∞—Å—Ç–æ–∫ —Ç–æ–∫–∞—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç",
          metadata: {
            color: "#9c27b0",
            workCount: 25
          }
        },
        {
          id: "machine1",
          parentId: "section1",
          name: "–°—Ç–∞–Ω–æ–∫ –ß–ü–£-1",
          metadata: {
            color: "#795548",
            workCount: 1
          }
        },
        {
          id: "machine2",
          parentId: "section1",
          name: "–°—Ç–∞–Ω–æ–∫ –ß–ü–£-2",
          metadata: {
            color: "#795548",
            workCount: 1
          }
        },
        {
          id: "factory2",
          parentId: null,
          name: "–ó–∞–≤–æ–¥ ‚Ññ2 '–≠–ª–µ–∫—Ç—Ä–æ–Ω'",
          metadata: {
            color: "#3f51b5",
            workCount: 120
          }
        },
        {
          id: "workshop3",
          parentId: "factory2",
          name: "–¶–µ—Ö –ø–µ—á–∞—Ç–Ω—ã—Ö –ø–ª–∞—Ç",
          metadata: {
            color: "#00bcd4",
            workCount: 35
          }
        },
        {
          id: "pcb_line1",
          parentId: "workshop3",
          name: "–õ–∏–Ω–∏—è –ü–ü-1",
          metadata: {
            color: "#e91e63",
            workCount: 8
          }
        },
        {
          id: "pcb_line2",
          parentId: "workshop3",
          name: "–õ–∏–Ω–∏—è –ü–ü-2",
          metadata: {
            color: "#e91e63",
            workCount: 6
          }
        }
      ]
    };
  };

  // === –ü–†–û–í–ê–ô–î–ï–† –î–ê–ù–ù–´–• ===
  window.customDataProvider = async function(startDate, days, leafNodes) {
    console.log(`[DataProvider] –ó–∞–≥—Ä—É–∑–∫–∞: ${startDate}, –¥–Ω–µ–π: ${days}, —É–∑–ª–æ–≤: ${leafNodes.length}`);

    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏
    await new Promise(resolve => setTimeout(resolve, 100));

    const batchData = [];
    const statuses = ["–ú", "–û", "–ü", "–ü–†", "–†"];

    // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã
    const [day, month, year] = startDate.split('.').map(Number);
    const startDateObj = new Date(year, month - 1, day);

    for (let i = 0; i < days; i++) {
      const currentDate = new Date(startDateObj);
      currentDate.setDate(startDateObj.getDate() + i);

      const dateStr = currentDate.toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });

      const dayData = {
        date: dateStr,
        timestamp: Date.now()
      };

      leafNodes.forEach(node => {
        dayData[node.id] = statuses[Math.floor(Math.random() * statuses.length)];
      });

      batchData.push(dayData);
    }

    return { data: batchData };
  };

  // === –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–õ–ò–ö–û–í ===
  window.handleCellClick = function(cellData) {
    console.log('[ClickHandler] –ö–ª–∏–∫ –ø–æ —è—á–µ–π–∫–µ:', cellData);
    console.log(`–î–∞—Ç–∞: ${cellData.date}, –£–∑–µ–ª: ${cellData.node?.name}, –ó–Ω–∞—á–µ–Ω–∏–µ: ${cellData.value}`);
  };

  // –°–æ–∑–¥–∞–µ–º –∞–ª–∏–∞—Å—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  // window.hp = window.HeadersProvider;
  window.hp = function() {
    console.log('[HeadersProvider] –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞');

    return {
      headers: [
        {
          id: "factory1",
          parentId: null,
          name: "–ó–∞–≤–æ–¥ ‚Ññ1 '–ú–µ—Ç–∞–ª–ª—É—Ä–≥'",
          metadata: {
            color: "#343434",
            workCount: 150
          }
        },
        {
          id: "workshop1",
          parentId: "factory1",
          name: "–¶–µ—Ö —Å–±–æ—Ä–∫–∏ ‚Ññ1",
          metadata: {
            color: "#4caf50",
            workCount: 45
          }
        },
        {
          id: "line1",
          parentId: "workshop1",
          name: "–õ–∏–Ω–∏—è –ê",
          metadata: {
            color: "#ff9800",
            workCount: 15
          }
        },
        {
          id: "station1",
          parentId: "line1",
          name: "–°—Ç–∞–Ω—Ü–∏—è 1",
          metadata: {
            color: "#f44336",
            workCount: 3
          }
        },
        {
          id: "station2",
          parentId: "line1",
          name: "–°—Ç–∞–Ω—Ü–∏—è 2",
          metadata: {
            color: "#f44336",
            workCount: 4
          }
        },
        {
          id: "station3",
          parentId: "line1",
          name: "–°—Ç–∞–Ω—Ü–∏—è 3",
          metadata: {
            color: "#f44336",
            workCount: 5
          }
        },
        {
          id: "line2",
          parentId: "workshop1",
          name: "–õ–∏–Ω–∏—è –ë",
          metadata: {
            color: "#ff9800",
            workCount: 12
          }
        },
        {
          id: "station4",
          parentId: "line2",
          name: "–°—Ç–∞–Ω—Ü–∏—è 4",
          metadata: {
            color: "#f44336",
            workCount: 2
          }
        },
        {
          id: "station5",
          parentId: "line2",
          name: "–°—Ç–∞–Ω—Ü–∏—è 5",
          metadata: {
            color: "#f44336",
            workCount: 3
          }
        },
        {
          id: "workshop2",
          parentId: "factory1",
          name: "–¶–µ—Ö –º–µ—Ö–∞–Ω–æ–æ–±—Ä–∞–±–æ—Ç–∫–∏",
          metadata: {
            color: "#4caf50",
            workCount: 65
          }
        },
        {
          id: "section1",
          parentId: "workshop2",
          name: "–£—á–∞—Å—Ç–æ–∫ —Ç–æ–∫–∞—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç",
          metadata: {
            color: "#9c27b0",
            workCount: 25
          }
        },
        {
          id: "machine1",
          parentId: "section1",
          name: "–°—Ç–∞–Ω–æ–∫ –ß–ü–£-1",
          metadata: {
            color: "#795548",
            workCount: 1
          }
        },
        {
          id: "machine2",
          parentId: "section1",
          name: "–°—Ç–∞–Ω–æ–∫ –ß–ü–£-2",
          metadata: {
            color: "#795548",
            workCount: 1
          }
        },
        {
          id: "factory2",
          parentId: null,
          name: "–ó–∞–≤–æ–¥ ‚Ññ2 '–≠–ª–µ–∫—Ç—Ä–æ–Ω'",
          metadata: {
            color: "#3f51b5",
            workCount: 120
          }
        },
        {
          id: "workshop3",
          parentId: "factory2",
          name: "–¶–µ—Ö –ø–µ—á–∞—Ç–Ω—ã—Ö –ø–ª–∞—Ç",
          metadata: {
            color: "#00bcd4",
            workCount: 35
          }
        },
        {
          id: "pcb_line1",
          parentId: "workshop3",
          name: "–õ–∏–Ω–∏—è –ü–ü-1",
          metadata: {
            color: "#e91e63",
            workCount: 8
          }
        },
        {
          id: "pcb_line2",
          parentId: "workshop3",
          name: "–õ–∏–Ω–∏—è –ü–ü-2",
          metadata: {
            color: "#e91e63",
            workCount: 6
          }
        }
      ]
    };
  };
  window.dp = window.customDataProvider;

  console.log('[HTML] –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:');
  console.log('- HeadersProvider:', typeof window.HeadersProvider);
  console.log('- customDataProvider:', typeof window.customDataProvider);
  console.log('- handleCellClick:', typeof window.handleCellClick);

  // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
  try {
    const testHeaders = window.HeadersProvider();
    console.log(`[HTML] –¢–µ—Å—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: ${testHeaders.headers.length} –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤`);
  } catch (error) {
    console.error('[HTML] –û—à–∏–±–∫–∞ –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:', error);
  }
</script>

<virtualized-table
        header-provider-name="HeadersProvider"
        data-provider-name="customDataProvider"
        on-cell-click-handler="handleCellClick"
        max-width="100%"
        max-height="600px"
        scroll-batch-size="7"
        debug="true">
</virtualized-table>

<!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ -->
<script>
  console.log('[HTML] –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Ç–∞–±–ª–∏—Ü—ã...');

  const script = document.createElement('script');
  script.src = '../dist/virtualized-table.js';

  script.onload = function() {
    console.log('[HTML] ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü—ã –∑–∞–≥—Ä—É–∂–µ–Ω');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(() => {
      const registered = customElements.get('virtualized-table');
      if (registered) {
        console.log('[HTML] ‚úÖ Web Component –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
        console.log('[HTML] üéØ –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏');
      } else {
        console.error('[HTML] ‚ùå Web Component –ù–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
      }
    }, 500);
  };

  script.onerror = function() {
    console.error('[HTML] ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞');
    console.log('[HTML] –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—É—Ç–∏:');
    console.log('- /dist/virtualized-table.js');
    console.log('- ./dist/virtualized-table.js');
  };

  document.head.appendChild(script);
</script>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: #f5f5f5;
  }
  h1 {
    color: #333;
    margin-bottom: 20px;
  }
  virtualized-table {
    background: white;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
</style>
</body>
</html>