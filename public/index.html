<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="utf-8" />-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1" />-->
<!--  <title>Virtualized Table - Working Example</title>-->
<!--  <style>-->
<!--    .debug-info {-->
<!--      background: #f8f9fa;-->
<!--      padding: 10px;-->
<!--      margin: 10px 0;-->
<!--      border-radius: 4px;-->
<!--      font-family: monospace;-->
<!--      font-size: 12px;-->
<!--      border: 1px solid #e9ecef;-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<h1>Таблица с провайдером 'М'</h1>-->

<!--<div class="debug-info" id="debug-info">-->
<!--  <strong>Статус:</strong> <span id="status">Инициализация...</span>-->
<!--</div>-->

<!--<virtualized-table-->
<!--        id="table"-->
<!--        max-width="100%"-->
<!--        max-height="600px"-->
<!--        scroll-batch-size="7"-->
<!--        debug="true">-->
<!--</virtualized-table>-->

<!--<script>-->
<!--  console.log('[Init] Начало инициализации');-->

<!--  const statusEl = document.getElementById('status');-->

<!--  function updateStatus(message) {-->
<!--    statusEl.textContent = message;-->
<!--    console.log(`[Status] ${message}`);-->
<!--  }-->

<!--  updateStatus('Установка провайдера...');-->

<!--  // Утилиты для работы с датами-->
<!--  function parseDateString(dateString) {-->
<!--    const [day, month, year] = dateString.split('.').map(Number);-->
<!--    return new Date(Date.UTC(year, month - 1, day));-->
<!--  }-->

<!--  function formatDate(date) {-->
<!--    return date.toLocaleDateString('ru-RU', {-->
<!--      day: '2-digit',-->
<!--      month: '2-digit',-->
<!--      year: 'numeric'-->
<!--    });-->
<!--  }-->

<!--  // Провайдер данных с 'М' во всех ячейках-->
<!--  window.dp = async (startDate, days) => {-->
<!--    console.log(`[Provider] Загрузка: ${startDate}, дней: ${days}`);-->
<!--    updateStatus(`Загрузка данных: ${startDate} (+${days} дней)`);-->

<!--    // Небольшая задержка для имитации сети-->
<!--    await new Promise(resolve => setTimeout(resolve, 200));-->

<!--    const startDateObj = parseDateString(startDate);-->
<!--    const batchData = [];-->

<!--    for (let i = 0; i < days; i++) {-->
<!--      const currentDate = new Date(startDateObj);-->
<!--      currentDate.setUTCDate(startDateObj.getUTCDate() + i);-->
<!--      const dateStr = formatDate(currentDate);-->

<!--      const dayData = {-->
<!--        date: dateStr,-->
<!--        agr1: 5,-->
<!--        agr2: 3,-->
<!--        agr3: 8,-->
<!--        stage1: [-->
<!--          {"20ГПА-1-1": "М"},-->
<!--          {"20ГПА-1-2": "М"},-->
<!--          {"20ГПА-1-3": "М"},-->
<!--          {"20ГПА-1-4": "М"},-->
<!--        ],-->
<!--        stage2: [-->
<!--          {"20ГПА-2-1": "М"},-->
<!--          {"20ГПА-2-2": "М"},-->
<!--          {"20ГПА-2-3": "М"},-->
<!--          {"20ГПА-2-4": "М"},-->
<!--        ],-->
<!--        stage3: [-->
<!--          {"20ГПА-3-1": "М"},-->
<!--          {"20ГПА-3-2": "М"},-->
<!--          {"20ГПА-3-3": "М"},-->
<!--          {"20ГПА-3-4": "М"},-->
<!--        ]-->
<!--      };-->

<!--      batchData.push(dayData);-->
<!--    }-->

<!--    console.log(`[Provider] Сгенерировано ${batchData.length} записей`);-->
<!--    updateStatus(`Данные загружены: ${batchData.length} записей`);-->

<!--    return { data: batchData };-->
<!--  };-->

<!--  updateStatus('Провайдер установлен, загрузка компонента...');-->

<!--  // Обработчик загрузки скрипта-->
<!--  function handleScriptLoad() {-->
<!--    updateStatus('Компонент загружен');-->

<!--    // Проверяем регистрацию web component-->
<!--    setTimeout(() => {-->
<!--      if (customElements.get('virtualized-table')) {-->
<!--        updateStatus('Web component зарегистрирован - готов к работе!');-->
<!--      } else {-->
<!--        updateStatus('ОШИБКА: Web component не зарегистрирован');-->
<!--      }-->
<!--    }, 500);-->
<!--  }-->

<!--  function handleScriptError() {-->
<!--    updateStatus('ОШИБКА: Не удалось загрузить компонент');-->
<!--    console.error('[Error] Ошибка загрузки скрипта компонента');-->
<!--  }-->

<!--  // Обработчик общих ошибок-->
<!--  window.addEventListener('error', (e) => {-->
<!--    console.error('[Global Error]', e.error);-->
<!--    updateStatus(`Ошибка: ${e.message}`);-->
<!--  });-->

<!--  // Проверка готовности DOM-->
<!--  if (document.readyState === 'loading') {-->
<!--    document.addEventListener('DOMContentLoaded', () => {-->
<!--      updateStatus('DOM готов');-->
<!--    });-->
<!--  } else {-->
<!--    updateStatus('DOM готов');-->
<!--  }-->

<!--  // Функция для попытки загрузки с разными путями-->
<!--  function tryLoadScript() {-->
<!--    const paths = [-->
<!--      './dist/virtualized-table.js',           // Относительный путь-->
<!--      '/dist/virtualized-table.js',            // Абсолютный путь-->
<!--      '../dist/virtualized-table.js',          // На уровень выше-->
<!--      'dist/virtualized-table.js',             // Без ./-->
<!--      './virtualized-table.js',                // В той же папке-->
<!--      '/public/dist/virtualized-table.js'      // Полный путь-->
<!--    ];-->

<!--    function loadWithPath(index = 0) {-->
<!--      if (index >= paths.length) {-->
<!--        updateStatus('ОШИБКА: Не удалось найти компонент ни по одному пути');-->
<!--        return;-->
<!--      }-->

<!--      const script = document.createElement('script');-->
<!--      script.src = paths[index];-->

<!--      script.onload = () => {-->
<!--        console.log(`[Success] Компонент загружен с пути: ${paths[index]}`);-->
<!--        handleScriptLoad();-->
<!--      };-->

<!--      script.onerror = () => {-->
<!--        console.log(`[Failed] Путь не работает: ${paths[index]}`);-->
<!--        loadWithPath(index + 1);-->
<!--      };-->

<!--      document.head.appendChild(script);-->
<!--    }-->

<!--    loadWithPath();-->
<!--  }-->

<!--  // Запускаем попытку загрузки-->
<!--  tryLoadScript();-->

<!--  // Финальная проверка через 3 секунды-->
<!--  setTimeout(() => {-->
<!--    const table = document.getElementById('table');-->
<!--    if (table && table.shadowRoot) {-->
<!--      updateStatus('Таблица инициализирована успешно!');-->
<!--    } else if (table) {-->
<!--      updateStatus('Элемент найден, но shadow DOM отсутствует');-->
<!--    } else {-->
<!--      updateStatus('ОШИБКА: Элемент таблицы не найден');-->
<!--    }-->
<!--  }, 3000);-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="utf-8" />-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1" />-->
<!--  <title>Enhanced Virtualized Table - Test with Header Provider</title>-->
<!--  <style>-->
<!--    .debug-info {-->
<!--      background: #f8f9fa;-->
<!--      padding: 10px;-->
<!--      margin: 10px 0;-->
<!--      border-radius: 4px;-->
<!--      font-family: monospace;-->
<!--      font-size: 12px;-->
<!--      border: 1px solid #e9ecef;-->
<!--    }-->
<!--    .provider-info {-->
<!--      background: #e3f2fd;-->
<!--      padding: 15px;-->
<!--      margin: 10px 0;-->
<!--      border-radius: 4px;-->
<!--      font-family: Arial, sans-serif;-->
<!--      font-size: 14px;-->
<!--      border: 1px solid #2196f3;-->
<!--    }-->
<!--    .provider-info h3 {-->
<!--      margin: 0 0 10px 0;-->
<!--      color: #1976d2;-->
<!--    }-->
<!--    .controls {-->
<!--      margin: 20px 0;-->
<!--      padding: 15px;-->
<!--      background: #f5f5f5;-->
<!--      border-radius: 4px;-->
<!--      border: 1px solid #ddd;-->
<!--    }-->
<!--    .controls button {-->
<!--      margin: 5px;-->
<!--      padding: 8px 16px;-->
<!--      background: #007bff;-->
<!--      color: white;-->
<!--      border: none;-->
<!--      border-radius: 4px;-->
<!--      cursor: pointer;-->
<!--    }-->
<!--    .controls button:hover {-->
<!--      background: #0056b3;-->
<!--    }-->
<!--    .controls button:disabled {-->
<!--      background: #6c757d;-->
<!--      cursor: not-allowed;-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<h1>Расширенная виртуализированная таблица с провайдером заголовков</h1>-->

<!--<div class="provider-info">-->
<!--  <h3>Информация о провайдерах:</h3>-->
<!--  <div><strong>Заголовки:</strong> Иерархическая структура завода (window.customHeaders)</div>-->
<!--  <div><strong>Данные:</strong> Автоматическое заполнение статусами 'М' для всех листовых узлов (window.customDataProvider)</div>-->
<!--</div>-->

<!--<div class="debug-info" id="debug-info">-->
<!--  <strong>Статус:</strong> <span id="status">Инициализация...</span><br>-->
<!--  <strong>Провайдер заголовков:</strong> <span id="header-status">Не установлен</span><br>-->
<!--  <strong>Провайдер данных:</strong> <span id="data-status">Не установлен</span>-->
<!--</div>-->

<!--<div class="controls">-->
<!--  <button id="btn-reload" onclick="reloadTable()">Перезагрузить таблицу</button>-->
<!--  <button id="btn-toggle-debug" onclick="toggleDebug()">Переключить отладку</button>-->
<!--  <button id="btn-inspect" onclick="inspectProviders()">Проверить провайдеры</button>-->
<!--</div>-->

<!--<virtualized-table-->
<!--        id="table"-->
<!--        header-provider-name="customHeaders"-->
<!--        data-provider-name="customDataProvider"-->
<!--        max-width="100%"-->
<!--        max-height="600px"-->
<!--        scroll-batch-size="7"-->
<!--        debug="true">-->
<!--</virtualized-table>-->

<!--<script>-->
<!--  console.log('[Init] Начало инициализации с провайдерами');-->

<!--  const statusEl = document.getElementById('status');-->
<!--  const headerStatusEl = document.getElementById('header-status');-->
<!--  const dataStatusEl = document.getElementById('data-status');-->

<!--  function updateStatus(message) {-->
<!--    statusEl.textContent = message;-->
<!--    console.log(`[Status] ${message}`);-->
<!--  }-->

<!--  function updateHeaderStatus(message) {-->
<!--    headerStatusEl.textContent = message;-->
<!--    console.log(`[Header Provider] ${message}`);-->
<!--  }-->

<!--  function updateDataStatus(message) {-->
<!--    dataStatusEl.textContent = message;-->
<!--    console.log(`[Data Provider] ${message}`);-->
<!--  }-->

<!--  updateStatus('Установка провайдеров...');-->

<!--  // === УТИЛИТЫ ===-->
<!--  function parseDateString(dateString) {-->
<!--    const [day, month, year] = dateString.split('.').map(Number);-->
<!--    return new Date(Date.UTC(year, month - 1, day));-->
<!--  }-->

<!--  function formatDate(date) {-->
<!--    return date.toLocaleDateString('ru-RU', {-->
<!--      day: '2-digit',-->
<!--      month: '2-digit',-->
<!--      year: 'numeric'-->
<!--    });-->
<!--  }-->

<!--  // === ПРОВАЙДЕР ЗАГОЛОВКОВ ===-->
<!--  window.customHeaders = {-->
<!--    "headers": [-->
<!--      {-->
<!--        "id": "factory1",-->
<!--        "parentId": null,-->
<!--        "type": "node",-->
<!--        "name": "Завод №1 'Металлург'",-->
<!--        "metadata": {-->
<!--          "color": "#2196f3",-->
<!--          "tooltip": "Основной производственный комплекс",-->
<!--          "workCount": 150-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "workshop1",-->
<!--        "parentId": "factory1",-->
<!--        "type": "assembly",-->
<!--        "name": "Цех сборки №1",-->
<!--        "metadata": {-->
<!--          "color": "#4caf50",-->
<!--          "tooltip": "Основной сборочный цех",-->
<!--          "workCount": 45-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "line1",-->
<!--        "parentId": "workshop1",-->
<!--        "type": "component",-->
<!--        "name": "Линия А",-->
<!--        "metadata": {-->
<!--          "color": "#ff9800",-->
<!--          "tooltip": "Автоматизированная линия сборки",-->
<!--          "workCount": 15-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "station1",-->
<!--        "parentId": "line1",-->
<!--        "type": "component",-->
<!--        "name": "Станция 1",-->
<!--        "metadata": {-->
<!--          "color": "#f44336",-->
<!--          "tooltip": "Начальная станция сборки",-->
<!--          "workCount": 3-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "station2",-->
<!--        "parentId": "line1",-->
<!--        "type": "component",-->
<!--        "name": "Станция 2",-->
<!--        "metadata": {-->
<!--          "color": "#f44336",-->
<!--          "tooltip": "Промежуточная станция",-->
<!--          "workCount": 4-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "station3",-->
<!--        "parentId": "line1",-->
<!--        "type": "component",-->
<!--        "name": "Станция 3",-->
<!--        "metadata": {-->
<!--          "color": "#f44336",-->
<!--          "tooltip": "Финальная станция",-->
<!--          "workCount": 5-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "line2",-->
<!--        "parentId": "workshop1",-->
<!--        "type": "component",-->
<!--        "name": "Линия Б",-->
<!--        "metadata": {-->
<!--          "color": "#ff9800",-->
<!--          "tooltip": "Полуавтоматическая линия",-->
<!--          "workCount": 12-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "station4",-->
<!--        "parentId": "line2",-->
<!--        "type": "component",-->
<!--        "name": "Станция 4",-->
<!--        "metadata": {-->
<!--          "color": "#f44336",-->
<!--          "tooltip": "Контрольная станция",-->
<!--          "workCount": 2-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "station5",-->
<!--        "parentId": "line2",-->
<!--        "type": "component",-->
<!--        "name": "Станция 5",-->
<!--        "metadata": {-->
<!--          "color": "#f44336",-->
<!--          "tooltip": "Упаковочная станция",-->
<!--          "workCount": 3-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "workshop2",-->
<!--        "parentId": "factory1",-->
<!--        "type": "assembly",-->
<!--        "name": "Цех механообработки",-->
<!--        "metadata": {-->
<!--          "color": "#4caf50",-->
<!--          "tooltip": "Цех механической обработки деталей",-->
<!--          "workCount": 65-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "section1",-->
<!--        "parentId": "workshop2",-->
<!--        "type": "component",-->
<!--        "name": "Участок токарных работ",-->
<!--        "metadata": {-->
<!--          "color": "#9c27b0",-->
<!--          "tooltip": "Участок токарной обработки",-->
<!--          "workCount": 25-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "machine1",-->
<!--        "parentId": "section1",-->
<!--        "type": "component",-->
<!--        "name": "Станок ЧПУ-1",-->
<!--        "metadata": {-->
<!--          "color": "#795548",-->
<!--          "tooltip": "Токарный станок с ЧПУ",-->
<!--          "workCount": 1-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "machine2",-->
<!--        "parentId": "section1",-->
<!--        "type": "component",-->
<!--        "name": "Станок ЧПУ-2",-->
<!--        "metadata": {-->
<!--          "color": "#795548",-->
<!--          "tooltip": "Фрезерный станок с ЧПУ",-->
<!--          "workCount": 1-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "factory2",-->
<!--        "parentId": null,-->
<!--        "type": "node",-->
<!--        "name": "Завод №2 'Электрон'",-->
<!--        "metadata": {-->
<!--          "color": "#3f51b5",-->
<!--          "tooltip": "Завод электронных компонентов",-->
<!--          "workCount": 120-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "workshop3",-->
<!--        "parentId": "factory2",-->
<!--        "type": "assembly",-->
<!--        "name": "Цех печатных плат",-->
<!--        "metadata": {-->
<!--          "color": "#00bcd4",-->
<!--          "tooltip": "Производство печатных плат",-->
<!--          "workCount": 35-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "pcb_line1",-->
<!--        "parentId": "workshop3",-->
<!--        "type": "component",-->
<!--        "name": "Линия ПП-1",-->
<!--        "metadata": {-->
<!--          "color": "#e91e63",-->
<!--          "tooltip": "Линия производства печатных плат",-->
<!--          "workCount": 8-->
<!--        }-->
<!--      },-->
<!--      {-->
<!--        "id": "pcb_line2",-->
<!--        "parentId": "workshop3",-->
<!--        "type": "component",-->
<!--        "name": "Линия ПП-2",-->
<!--        "metadata": {-->
<!--          "color": "#e91e63",-->
<!--          "tooltip": "Линия производства сложных плат",-->
<!--          "workCount": 6-->
<!--        }-->
<!--      }-->
<!--    ]-->
<!--  };-->

<!--  updateHeaderStatus('Установлен - ' + window.customHeaders.headers.length + ' узлов');-->

<!--  // === ПРОВАЙДЕР ДАННЫХ ===-->
<!--  window.customDataProvider = async (startDate, days, leafNodes) => {-->
<!--    console.log(`[Custom Data Provider] Загрузка: ${startDate}, дней: ${days}, листовых узлов: ${leafNodes.length}`);-->
<!--    updateDataStatus(`Загрузка: ${startDate} (+${days} дней, ${leafNodes.length} колонок)`);-->

<!--    // Имитация сетевой задержки-->
<!--    await new Promise(resolve => setTimeout(resolve, 300));-->

<!--    const startDateObj = parseDateString(startDate);-->
<!--    const batchData = [];-->

<!--    // Возможные статусы для разнообразия-->
<!--    const statuses = ["М", "О", "П", "ПР", "Р"];-->
<!--    const getRandomStatus = () => statuses[Math.floor(Math.random() * statuses.length)];-->

<!--    for (let i = 0; i < days; i++) {-->
<!--      const currentDate = new Date(startDateObj);-->
<!--      currentDate.setUTCDate(startDateObj.getUTCDate() + i);-->
<!--      const dateStr = formatDate(currentDate);-->

<!--      const dayData = {-->
<!--        date: dateStr,-->
<!--        timestamp: Date.now()-->
<!--      };-->

<!--      // Заполняем данные для всех листовых узлов-->
<!--      leafNodes.forEach(node => {-->
<!--        // Большинство ячеек будут 'М', но иногда другие статусы для демонстрации rowspan-->
<!--        if (Math.random() > 0.85) {-->
<!--          dayData[node.id] = getRandomStatus();-->
<!--        } else {-->
<!--          dayData[node.id] = 'М';-->
<!--        }-->
<!--      });-->

<!--      batchData.push(dayData);-->
<!--    }-->

<!--    console.log(`[Custom Data Provider] Сгенерировано ${batchData.length} записей для ${leafNodes.length} колонок`);-->
<!--    updateDataStatus(`Готово: ${batchData.length} записей для ${leafNodes.length} колонок`);-->

<!--    return { data: batchData };-->
<!--  };-->

<!--  updateDataStatus('Установлен и готов');-->
<!--  updateStatus('Провайдеры установлены, загрузка компонента...');-->

<!--  // === ФУНКЦИИ УПРАВЛЕНИЯ ===-->
<!--  function reloadTable() {-->
<!--    const table = document.getElementById('table');-->
<!--    const parent = table.parentNode;-->
<!--    const newTable = table.cloneNode(true);-->
<!--    parent.removeChild(table);-->
<!--    parent.appendChild(newTable);-->
<!--    updateStatus('Таблица перезагружена');-->
<!--  }-->

<!--  function toggleDebug() {-->
<!--    const table = document.getElementById('table');-->
<!--    const currentDebug = table.getAttribute('debug');-->
<!--    const newDebug = currentDebug === 'true' ? 'false' : 'true';-->
<!--    table.setAttribute('debug', newDebug);-->
<!--    updateStatus(`Отладка: ${newDebug}`);-->
<!--  }-->

<!--  function inspectProviders() {-->
<!--    console.log('=== ИНСПЕКЦИЯ ПРОВАЙДЕРОВ ===');-->
<!--    console.log('Header Provider (window.customHeaders):', window.customHeaders);-->
<!--    console.log('Data Provider (window.customDataProvider):', window.customDataProvider);-->

<!--    if (window.customHeaders) {-->
<!--      const leafCount = window.customHeaders.headers.filter(h =>-->
<!--              !window.customHeaders.headers.some(child => child.parentId === h.id)-->
<!--      ).length;-->
<!--      console.log(`Листовых узлов в заголовках: ${leafCount}`);-->
<!--    }-->

<!--    updateStatus('Проверка провайдеров выполнена (см. консоль)');-->
<!--  }-->

<!--  // === ОБРАБОТЧИКИ ЗАГРУЗКИ ===-->
<!--  function handleScriptLoad() {-->
<!--    updateStatus('Компонент загружен');-->

<!--    setTimeout(() => {-->
<!--      if (customElements.get('virtualized-table')) {-->
<!--        updateStatus('Web component зарегистрирован - готов к работе!');-->
<!--      } else {-->
<!--        updateStatus('ОШИБКА: Web component не зарегистрирован');-->
<!--      }-->
<!--    }, 500);-->
<!--  }-->

<!--  function handleScriptError() {-->
<!--    updateStatus('ОШИБКА: Не удалось загрузить компонент');-->
<!--    console.error('[Error] Ошибка загрузки скрипта компонента');-->
<!--  }-->

<!--  // Обработчик общих ошибок-->
<!--  window.addEventListener('error', (e) => {-->
<!--    console.error('[Global Error]', e.error);-->
<!--    updateStatus(`Ошибка: ${e.message}`);-->
<!--  });-->

<!--  // Проверка готовности DOM-->
<!--  if (document.readyState === 'loading') {-->
<!--    document.addEventListener('DOMContentLoaded', () => {-->
<!--      updateStatus('DOM готов');-->
<!--    });-->
<!--  } else {-->
<!--    updateStatus('DOM готов');-->
<!--  }-->

<!--  // Функция для попытки загрузки с разными путями-->
<!--  function tryLoadScript() {-->
<!--    const paths = [-->
<!--      './dist/virtualized-table.js',           // Относительный путь-->
<!--      '/dist/virtualized-table.js',            // Абсолютный путь-->
<!--      '../dist/virtualized-table.js',          // На уровень выше-->
<!--      'dist/virtualized-table.js',             // Без ./-->
<!--      './virtualized-table.js',                // В той же папке-->
<!--      '/public/dist/virtualized-table.js'      // Полный путь-->
<!--    ];-->

<!--    function loadWithPath(index = 0) {-->
<!--      if (index >= paths.length) {-->
<!--        updateStatus('ОШИБКА: Не удалось найти компонент ни по одному пути');-->
<!--        return;-->
<!--      }-->

<!--      const script = document.createElement('script');-->
<!--      script.src = paths[index];-->

<!--      script.onload = () => {-->
<!--        console.log(`[Success] Компонент загружен с пути: ${paths[index]}`);-->
<!--        handleScriptLoad();-->
<!--      };-->

<!--      script.onerror = () => {-->
<!--        console.log(`[Failed] Путь не работает: ${paths[index]}`);-->
<!--        loadWithPath(index + 1);-->
<!--      };-->

<!--      document.head.appendChild(script);-->
<!--    }-->

<!--    loadWithPath();-->
<!--  }-->

<!--  // Запускаем попытку загрузки-->
<!--  tryLoadScript();-->

<!--  // Финальная проверка через 3 секунды-->
<!--  setTimeout(() => {-->
<!--    const table = document.getElementById('table');-->
<!--    if (table && table.shadowRoot) {-->
<!--      updateStatus('Таблица инициализирована успешно!');-->

<!--      // Дополнительная информация-->
<!--      setTimeout(() => {-->
<!--        const leafNodes = window.customHeaders.headers.filter(h =>-->
<!--                !window.customHeaders.headers.some(child => child.parentId === h.id)-->
<!--        );-->
<!--        updateStatus(`Работает! Листовых колонок: ${leafNodes.length}`);-->
<!--      }, 1000);-->

<!--    } else if (table) {-->
<!--      updateStatus('Элемент найден, но shadow DOM отсутствует');-->
<!--    } else {-->
<!--      updateStatus('ОШИБКА: Элемент таблицы не найден');-->
<!--    }-->
<!--  }, 3000);-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Enhanced Virtualized Table - Test with Header Provider</title>
  <style>
    .debug-info {
      background: #f8f9fa;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      border: 1px solid #e9ecef;
    }
    .provider-info h3 {
      margin: 0 0 10px 0;
      color: #1976d2;
    }
    .controls {
      margin: 20px 0;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .controls button {
      margin: 5px;
      padding: 8px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .controls button:hover {
      background: #0056b3;
    }
    .controls button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
<h1>Расширенная виртуализированная таблица с провайдером заголовков</h1>
<div class="debug-info" id="debug-info">
  <strong>Статус:</strong> <span id="status">Инициализация...</span><br>
  <strong>Провайдер заголовков:</strong> <span id="header-status">Не установлен</span><br>
  <strong>Провайдер данных:</strong> <span id="data-status">Не установлен</span>
</div>

<virtualized-table
        id="table"
        header-provider-name="customHeaders"
        data-provider-name="customDataProvider"
        max-width="100%"
        max-height="600px"
        scroll-batch-size="7"
        debug="true">
</virtualized-table>

<script>
  const statusEl = document.getElementById('status');
  const headerStatusEl = document.getElementById('header-status');
  const dataStatusEl = document.getElementById('data-status');

  function updateStatus(message) {
    statusEl.textContent = message;
    console.log(`[Status] ${message}`);
  }

  function updateHeaderStatus(message) {
    headerStatusEl.textContent = message;
    console.log(`[Header Provider] ${message}`);
  }

  function updateDataStatus(message) {
    dataStatusEl.textContent = message;
    console.log(`[Data Provider] ${message}`);
  }

  updateStatus('Установка провайдеров...');

  // === УТИЛИТЫ ===
  function parseDateString(dateString) {
    const [day, month, year] = dateString.split('.').map(Number);
    return new Date(Date.UTC(year, month - 1, day));
  }

  function formatDate(date) {
    return date.toLocaleDateString('ru-RU', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric'
    });
  }

  // === ПРОВАЙДЕР ЗАГОЛОВКОВ ===
  window.customHeaders = {
    "headers": [
      {
        "id": "factory1",
        "parentId": null,
        "type": "node",
        "name": "Завод №1 'Металлург'",
        "metadata": {
          "color": "#2196f3",
          "tooltip": "Основной производственный комплекс",
          "workCount": 150
        }
      },
      {
        "id": "workshop1",
        "parentId": "factory1",
        "type": "assembly",
        "name": "Цех сборки №1",
        "metadata": {
          "color": "#4caf50",
          "tooltip": "Основной сборочный цех",
          "workCount": 45
        }
      },
      {
        "id": "line1",
        "parentId": "workshop1",
        "type": "component",
        "name": "Линия А",
        "metadata": {
          "color": "#ff9800",
          "tooltip": "Автоматизированная линия сборки",
          "workCount": 15
        }
      },
      {
        "id": "station1",
        "parentId": "line1",
        "type": "component",
        "name": "Станция 1",
        "metadata": {
          "color": "#f44336",
          "tooltip": "Начальная станция сборки",
          "workCount": 3
        }
      },
      {
        "id": "station2",
        "parentId": "line1",
        "type": "component",
        "name": "Станция 2",
        "metadata": {
          "color": "#f44336",
          "tooltip": "Промежуточная станция",
          "workCount": 4
        }
      },
      {
        "id": "station3",
        "parentId": "line1",
        "type": "component",
        "name": "Станция 3",
        "metadata": {
          "color": "#f44336",
          "tooltip": "Финальная станция",
          "workCount": 5
        }
      },
      {
        "id": "line2",
        "parentId": "workshop1",
        "type": "component",
        "name": "Линия Б",
        "metadata": {
          "color": "#ff9800",
          "tooltip": "Полуавтоматическая линия",
          "workCount": 12
        }
      },
      {
        "id": "station4",
        "parentId": "line2",
        "type": "component",
        "name": "Станция 4",
        "metadata": {
          "color": "#f44336",
          "tooltip": "Контрольная станция",
          "workCount": 2
        }
      },
      {
        "id": "station5",
        "parentId": "line2",
        "type": "component",
        "name": "Станция 5",
        "metadata": {
          "color": "#f44336",
          "tooltip": "Упаковочная станция",
          "workCount": 3
        }
      },
      {
        "id": "workshop2",
        "parentId": "factory1",
        "type": "assembly",
        "name": "Цех механообработки",
        "metadata": {
          "color": "#4caf50",
          "tooltip": "Цех механической обработки деталей",
          "workCount": 65
        }
      },
      {
        "id": "section1",
        "parentId": "workshop2",
        "type": "component",
        "name": "Участок токарных работ",
        "metadata": {
          "color": "#9c27b0",
          "tooltip": "Участок токарной обработки",
          "workCount": 25
        }
      },
      {
        "id": "machine1",
        "parentId": "section1",
        "type": "component",
        "name": "Станок ЧПУ-1",
        "metadata": {
          "color": "#795548",
          "tooltip": "Токарный станок с ЧПУ",
          "workCount": 1
        }
      },
      {
        "id": "machine2",
        "parentId": "section1",
        "type": "component",
        "name": "Станок ЧПУ-2",
        "metadata": {
          "color": "#795548",
          "tooltip": "Фрезерный станок с ЧПУ",
          "workCount": 1
        }
      },
      {
        "id": "factory2",
        "parentId": null,
        "type": "node",
        "name": "Завод №2 'Электрон'",
        "metadata": {
          "color": "#3f51b5",
          "tooltip": "Завод электронных компонентов",
          "workCount": 120
        }
      },
      {
        "id": "workshop3",
        "parentId": "factory2",
        "type": "assembly",
        "name": "Цех печатных плат",
        "metadata": {
          "color": "#00bcd4",
          "tooltip": "Производство печатных плат",
          "workCount": 35
        }
      },
      {
        "id": "pcb_line1",
        "parentId": "workshop3",
        "type": "component",
        "name": "Линия ПП-1",
        "metadata": {
          "color": "#e91e63",
          "tooltip": "Линия производства печатных плат",
          "workCount": 8
        }
      },
      {
        "id": "pcb_line2",
        "parentId": "workshop3",
        "type": "component",
        "name": "Линия ПП-2",
        "metadata": {
          "color": "#e91e63",
          "tooltip": "Линия производства сложных плат",
          "workCount": 6
        }
      }
    ]
  };

  updateHeaderStatus('Установлен - ' + window.customHeaders.headers.length + ' узлов');

  // === ПРОВАЙДЕР ДАННЫХ ===
  window.customDataProvider = async (startDate, days, leafNodes) => {
    console.log(`[Custom Data Provider] Загрузка: ${startDate}, дней: ${days}, листовых узлов: ${leafNodes.length}`);
    updateDataStatus(`Загрузка: ${startDate} (+${days} дней, ${leafNodes.length} колонок)`);

    // Имитация сетевой задержки
    await new Promise(resolve => setTimeout(resolve, 300));

    const startDateObj = parseDateString(startDate);
    const batchData = [];

    // Возможные статусы для разнообразия
    const statuses = ["М", "О", "П", "ПР", "Р"];
    const getRandomStatus = () => statuses[Math.floor(Math.random() * statuses.length)];

    for (let i = 0; i < days; i++) {
      const currentDate = new Date(startDateObj);
      currentDate.setUTCDate(startDateObj.getUTCDate() + i);
      const dateStr = formatDate(currentDate);

      const dayData = {
        date: dateStr,
        timestamp: Date.now()
      };

      // Заполняем данные для всех листовых узлов
      leafNodes.forEach(node => {
        // Большинство ячеек будут 'М', но иногда другие статусы для демонстрации rowspan
        if (Math.random() > 0.85) {
          dayData[node.id] = getRandomStatus();
        } else {
          dayData[node.id] = 'М';
        }
      });

      batchData.push(dayData);
    }

    console.log(`[Custom Data Provider] Сгенерировано ${batchData.length} записей для ${leafNodes.length} колонок`);
    updateDataStatus(`Готово: ${batchData.length} записей для ${leafNodes.length} колонок`);

    return { data: batchData };
  };

  updateDataStatus('Установлен и готов');
  updateStatus('Провайдеры установлены, загрузка компонента...');

  // === ОБРАБОТЧИКИ ЗАГРУЗКИ ===
  function handleScriptLoad() {
    updateStatus('Компонент загружен');

    setTimeout(() => {
      if (customElements.get('virtualized-table')) {
        updateStatus('Web component зарегистрирован - готов к работе!');
      } else {
        updateStatus('ОШИБКА: Web component не зарегистрирован');
      }
    }, 500);
  }

  // Обработчик общих ошибок
  window.addEventListener('error', (e) => {
    console.error('[Global Error]', e.error);
    updateStatus(`Ошибка: ${e.message}`);
  });

  // Проверка готовности DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      updateStatus('DOM готов');
    });
  } else {
    updateStatus('DOM готов');
  }

  // Функция для попытки загрузки с разными путями
  function tryLoadScript() {
    const paths = [
      './dist/virtualized-table.js',           // Относительный путь
      '/dist/virtualized-table.js',            // Абсолютный путь
      '../dist/virtualized-table.js',          // На уровень выше
      'dist/virtualized-table.js',             // Без ./
      './virtualized-table.js',                // В той же папке
      '/public/dist/virtualized-table.js'      // Полный путь
    ];

    function loadWithPath(index = 0) {
      if (index >= paths.length) {
        updateStatus('ОШИБКА: Не удалось найти компонент ни по одному пути');
        return;
      }

      const script = document.createElement('script');
      script.src = paths[index];

      script.onload = () => {
        console.log(`[Success] Компонент загружен с пути: ${paths[index]}`);
        handleScriptLoad();
      };

      script.onerror = () => {
        console.log(`[Failed] Путь не работает: ${paths[index]}`);
        loadWithPath(index + 1);
      };

      document.head.appendChild(script);
    }

    loadWithPath();
  }

  // Запускаем попытку загрузки
  tryLoadScript();

  // Финальная проверка через 3 секунды
  setTimeout(() => {
    const table = document.getElementById('table');
    if (table && table.shadowRoot) {
      updateStatus('Таблица инициализирована успешно!');

      // Дополнительная информация
      setTimeout(() => {
        const leafNodes = window.customHeaders.headers.filter(h =>
                !window.customHeaders.headers.some(child => child.parentId === h.id)
        );
        updateStatus(`Листовых колонок: ${leafNodes.length}`);
      }, 1000);

    } else if (table) {
      updateStatus('Элемент найден, но shadow DOM отсутствует');
    } else {
      updateStatus('ОШИБКА: Элемент таблицы не найден');
    }
  }, 3000);
</script>
</body>
</html>