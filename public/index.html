<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Виртуализированная таблица с логикой up/down</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    virtualized-table {
      background: white;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .status {
      background: #e8f4fd;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .direction-info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .controls {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .control-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      margin: 5px;
      border-radius: 4px;
      cursor: pointer;
    }
    .control-button:hover {
      background: #0056b3;
    }
    .direction-indicator {
      display: inline-block;
      padding: 4px 8px;
      margin: 0 5px;
      border-radius: 3px;
      font-size: 12px;
      font-weight: bold;
    }
    .direction-up {
      background: #d4edda;
      color: #155724;
    }
    .direction-down {
      background: #cce7ff;
      color: #004085;
    }
  </style>
</head>
<body>
<h1>Виртуализированная таблица с новой логикой направлений</h1>

<virtualized-table
        max-width="100%"
        max-height="600px"
        scroll-batch-size="14"
        debug="true">
</virtualized-table>

<script>
  // 1. Async провайдер заголовков
  window.hp = async function() {
    console.log('[ASYNC HP] Загрузка заголовков...');

    await new Promise(resolve => setTimeout(resolve, 100));

    console.log('[ASYNC HP] Заголовки загружены');
    return {
      "headers": [
        {
          "id": "factory1",
          "parentId": null,
          "type": "node",
          "name": "Завод №1 'Металлург'",
          "metadata": {
            "color": "#343434",
            "tooltip": "Основной производственный комплекс",
            "workCount": 150
          }
        },
        {
          "id": "workshop1",
          "parentId": "factory1",
          "type": "assembly",
          "name": "Цех сборки №1",
          "metadata": {
            "color": "#4caf50",
            "tooltip": "Основной сборочный цех",
            "workCount": 45
          }
        },
        {
          "id": "line1",
          "parentId": "workshop1",
          "type": "component",
          "name": "Линия А",
          "metadata": {
            "color": "#ff9800",
            "tooltip": "Автоматизированная линия сборки",
            "workCount": 15
          }
        },
        {
          "id": "station1",
          "parentId": "line1",
          "type": "component",
          "name": "Станция 1",
          "metadata": {
            "color": "#f44336",
            "tooltip": "Начальная станция сборки",
            "workCount": 3
          }
        },
        {
          "id": "station2",
          "parentId": "line1",
          "type": "component",
          "name": "Станция 2",
          "metadata": {
            "color": "#f44336",
            "tooltip": "Промежуточная станция",
            "workCount": 4
          }
        },
        {
          "id": "station3",
          "parentId": "line1",
          "type": "component",
          "name": "Станция 3",
          "metadata": {
            "color": "#f44336",
            "tooltip": "Финальная станция",
            "workCount": 5
          }
        },
        {
          "id": "line2",
          "parentId": "workshop1",
          "type": "component",
          "name": "Линия Б",
          "metadata": {
            "color": "#ff9800",
            "tooltip": "Полуавтоматическая линия",
            "workCount": 12
          }
        },
        {
          "id": "station4",
          "parentId": "line2",
          "type": "component",
          "name": "Станция 4",
          "metadata": {
            "color": "#f44336",
            "tooltip": "Контрольная станция",
            "workCount": 2
          }
        },
        {
          "id": "station5",
          "parentId": "line2",
          "type": "component",
          "name": "Станция 5",
          "metadata": {
            "color": "#f44336",
            "tooltip": "Упаковочная станция",
            "workCount": 3
          }
        },
        {
          "id": "workshop2",
          "parentId": "factory1",
          "type": "assembly",
          "name": "Цех механообработки",
          "metadata": {
            "color": "#4caf50",
            "tooltip": "Цех механической обработки деталей",
            "workCount": 65
          }
        },
        {
          "id": "section1",
          "parentId": "workshop2",
          "type": "component",
          "name": "Участок токарных работ",
          "metadata": {
            "color": "#9c27b0",
            "tooltip": "Участок токарной обработки",
            "workCount": 25
          }
        },
        {
          "id": "machine1",
          "parentId": "section1",
          "type": "component",
          "name": "Станок ЧПУ-1",
          "metadata": {
            "color": "#795548",
            "tooltip": "Токарный станок с ЧПУ",
            "workCount": 1
          }
        },
        {
          "id": "machine2",
          "parentId": "section1",
          "type": "component",
          "name": "Станок ЧПУ-2",
          "metadata": {
            "color": "#795548",
            "tooltip": "Фрезерный станок с ЧПУ",
            "workCount": 1
          }
        },
        {
          "id": "factory2",
          "parentId": null,
          "type": "node",
          "name": "Завод №2 'Электрон'",
          "metadata": {
            "color": "#3f51b5",
            "tooltip": "Завод электронных компонентов",
            "workCount": 120
          }
        },
        {
          "id": "workshop3",
          "parentId": "factory2",
          "type": "assembly",
          "name": "Цех печатных плат",
          "metadata": {
            "color": "#00bcd4",
            "tooltip": "Производство печатных плат",
            "workCount": 35
          }
        },
        {
          "id": "pcb_line1",
          "parentId": "workshop3",
          "type": "component",
          "name": "Линия ПП-1",
          "metadata": {
            "color": "#e91e63",
            "tooltip": "Линия производства печатных плат",
            "workCount": 8
          }
        },
        {
          "id": "pcb_line2",
          "parentId": "workshop3",
          "type": "component",
          "name": "Линия ПП-2",
          "metadata": {
            "color": "#e91e63",
            "tooltip": "Линия производства сложных плат",
            "workCount": 6
          }
        }
      ]
    }
  };

  // 2. Async провайдер данных с новой логикой up/down
  window.dp = async function(startDate, direction, batchSize) {
    const data = {
      "data": [
        {
          "date": "10.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М",
              "rowspan": 7,
              "color": "red",
              "draggable": true
            },
            {
              "headerId": "station2",
              "value": "О",
              "color": "red",
              "draggable": true
            },
            {
              "headerId": "station3",
              "value": "П",
              "color": "red",
              "draggable": true
            },
            {
              "headerId": "station4",
              "value": "Р",
              "color": "red",
              "draggable": true
            },
            {
              "headerId": "station5",
              "value": "П",
              "color": "red",
              "draggable": true
            }
          ]
        },
        {
          "date": "11.09.2025",
          "columns": [
            // {
            //   "headerId": "station1",
            //   "value": "М",
            //   "color": "red",
            //   "draggable": false
            // },
            {
              "headerId": "station2",
              "value": "Р",
              "draggable": false
            },
            {
              "headerId": "station3",
              "value": "М",
              "draggable": false
            },
            {
              "headerId": "station4",
              "value": "О",
              "draggable": false
            },
            {
              "headerId": "station5",
              "value": "П",
              "draggable": false
            }
          ]
        },
        {
          "date": "12.09.2025",
          "columns": [
            // {
            //   "headerId": "station1",
            //   "value": "Р",
            //   "draggable": true
            // },
            {
              "headerId": "station2",
              "value": "П",
              "draggable": true
            },
            {
              "headerId": "station3",
              "value": "П",
              "draggable": true
            },
            {
              "headerId": "station4",
              "value": "М",
              "draggable": true
            },
            {
              "headerId": "station5",
              "value": "О"
            }
          ]
        },
        {
          "date": "13.09.2025",
          "columns": [
            // {
            //   "headerId": "station1",
            //   "value": "Р"
            // },
            {
              "headerId": "station2",
              "value": "Р"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "М"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "14.09.2025",
          "columns": [
            // {
            //   "headerId": "station1",
            //   "value": "М"
            // },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        },
        {
          "date": "15.09.2025",
          "columns": [
            // {
            //   "headerId": "station1",
            //   "value": "П"
            // },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "16.09.2025",
          "columns": [
            // {
            //   "headerId": "station1",
            //   "value": "П"
            // },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "17.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "18.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "19.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "20.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "21.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "22.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "23.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "24.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "25.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "26.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "27.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "28.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "29.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "30.09.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "П"
            },
            {
              "headerId": "station2",
              "value": "М"
            },
            {
              "headerId": "station3",
              "value": "Р"
            },
            {
              "headerId": "station4",
              "value": "П"
            },
            {
              "headerId": "station5",
              "value": "Р"
            }
          ]
        },
        {
          "date": "01.10.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М"
            },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        },
        {
          "date": "02.10.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М"
            },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        },
        {
          "date": "03.10.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М"
            },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        },
        {
          "date": "04.10.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М"
            },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        },
        {
          "date": "05.10.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М"
            },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        },
        {
          "date": "06.10.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М"
            },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        },
        {
          "date": "07.10.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М"
            },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        },
        {
          "date": "08.10.2025",
          "columns": [
            {
              "headerId": "station1",
              "value": "М"
            },
            {
              "headerId": "station2",
              "value": "О"
            },
            {
              "headerId": "station3",
              "value": "П"
            },
            {
              "headerId": "station4",
              "value": "Р"
            },
            {
              "headerId": "station5",
              "value": "П"
            }
          ]
        }
      ]
    };

    return JSON.stringify(data);
  };

  // Загрузка компонента
  const script = document.createElement('script');
  script.src = '../dist/virtualized-table.js'; // Исправленный путь

  script.onerror = function() {
    console.error('[HTML] ❌ Ошибка загрузки компонента');

    document.querySelector('virtualized-table').innerHTML = `
        <div style="padding: 20px; text-align: center; color: #721c24; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px;">
          <h3>Ошибка загрузки компонента</h3>
          <p>Не удалось загрузить файл virtualized-table.js</p>
          <p><small>Проверьте путь к файлу и убедитесь, что он собран корректно</small></p>
        </div>
      `;
  };

  document.head.appendChild(script);
</script>
</body>
</html>